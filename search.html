<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Search</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<style>
.form-control:focus {
    border-color: white;
    box-shadow: 0 0 0 0rem rgba(0, 0, 0, 0.25); 
}

</style> 
<body onkeydown="search()" >
    <nav class="text-center shadow navbar navbar-light navbar-expand-md fixed-top" style="font-weight: bold;background: #73325c;color: #f9ebcd;">
        <div class="input-group pulse animated mt-2 mb-2 mx-2">
            <a class="btn px-2" type="button" id="button-addon2" href="index.html"  style="background-color:#ffffff;color:#73325c;"><span class="material-symbols-outlined">arrow_back_ios</span></a>
            <input type="text" class="form-control" id="searchInput" placeholder="Search" aria-label="" aria-describedby="button-addon2">
            <button class="btn px-4" type="button" id="button-addon2" onclick="search()" id="change-bg" style="background-color:#f9ebcd;color:#73325c;"><span class="material-symbols-outlined">search</span></button>
        </div>
    </nav>

    <div class="mt-4 pt-5" id="articleContainer">
    </div>

    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/bs-init.js"></script>
    <script>
        const file_list = [];
        const search_data = [];
        const articleContainer = document.getElementById('articleContainer');
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('searchInput').focus();
            // AJAX request to fetch article headings
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'assets/textFiles/index/search_index.txt', true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    const lines = xhr.responseText.split('\n');
                    lines.forEach(function (line) {
                        if (line.trim() !== '') {
                            file_list.push(line);
                        }
                    });
                    fetchDataFromFile();
                }
            };
            xhr.send();
        });
        
        

        // Function to fetch data from a single file
        function fetchDataFromFile() {
                for(i=0;i<file_list.length;i++){
                    const xhr = new XMLHttpRequest();
                    xhr.open('GET', 'assets/textFiles/index/' + file_list[i]+'.txt', true);
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4 && xhr.status === 200) {
                            const content = xhr.responseText;

                            // Split the content into lines
                            const lines = content.split('\n');

                            // Process each line and extract 'heading' and 'link'
                            lines.forEach(line => {
                                const data = line.trim().split('|');
                                const heading = data[1];
                                const link = data[2];
                                if (heading && link) {
                                    search_data.push({ heading, link });
                                }
                            });
                        } else if (xhr.readyState === 4) {
                            reject('Failed to fetch data from ' + file_list[i]);
                        }
                    };
                    xhr.send();
                }
        }

        
        
        
        function search(){
            var query = document.getElementById('searchInput').value;
            if(query!==''){
                const results = search_data.filter(item => item.heading.toLowerCase().includes(query));
                results.forEach(result => {
                    articleContainer.innerHTML = '';
                    const articleCard = createArticleCard(result.heading,result.link);
                    articleContainer.appendChild(articleCard);
                });
            }else{
                articleContainer.innerHTML = '';
            }

            function createArticleCard(heading,link) {
                const cardLink = document.createElement('a');
                cardLink.href = 'display.html?heading=' + encodeURIComponent(heading) + '&contentfile=' + encodeURIComponent(link);
                cardLink.target = "_top";
            
                const cardRow = document.createElement('div');
                cardRow.className = 'row border-bottom pt-2 shadow ';
                cardRow.style.backgroundColor = "#ffffff";
                cardRow.style.color = "#73325c"
            
                const symbolDiv = document.createElement('div');
                symbolDiv.className = 'col-2 text-end';
            
                const symbolSpan = document.createElement('span');
                symbolSpan.className = 'material-symbols-outlined';
                symbolSpan.textContent = 'search';
            
                symbolDiv.appendChild(symbolSpan);
            
                const headingDiv = document.createElement('div');
                headingDiv.className = 'col-8';
            
                const headingSpan = document.createElement('p');
                headingSpan.textContent = heading;
            
                headingDiv.appendChild(headingSpan);
        
            
                cardRow.appendChild(symbolDiv);
                cardRow.appendChild(headingDiv);
                cardLink.appendChild(cardRow);
            
                return cardLink;
            }
        }
    
    </script>
</body>

</html>